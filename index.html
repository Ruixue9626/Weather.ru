<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather.ru</title>
  <style>
    html,body { 
      height:100%; margin:0; 
      font-family: "Segoe UI", Roboto, system-ui, -apple-system; 
      background-color: #DBE7F5;  /* 固定嫩藍背景 */
      color: #000000;  /* 文字黑 */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    body { overflow-y:auto; background-size:cover; background-position:center; padding-bottom:100px; }

    .banner {
      position:fixed;
      top:0; left:0; right:0;
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 20px;
      box-sizing:border-box;
      background: #A3BFD9;  /* 柔和藍灰橫幅 */
      border-bottom-left-radius:12px;
      border-bottom-right-radius:12px;
      z-index:10;
      color: #000000;  /* 橫幅文字黑 */
    }
    .left, .center, .right { display:flex; align-items:center; gap:10px; }
    .left .brand { font-weight:700; font-size:20px; }
    .center .time { font-size:18px; font-weight:600; }
    .right .cond { font-size:16px; display:flex; align-items:center; gap:8px; }

    .main {
      margin-top: 120px;
      padding: 0 20px;
      text-align:center;
      text-shadow: none;
    }
    .main .big-temp { font-size:96px; font-weight:800; line-height:0.9; }
    .main .small { font-size:24px; margin-top:8px; opacity:0.95; }

    table.hourly-forecast {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 600px;
      font-size: 16px;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
      color: #000;
    }
    table.hourly-forecast th, table.hourly-forecast td {
      padding: 10px 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    table.hourly-forecast th {
      background-color: #A3BFD9;
      font-weight: 700;
    }
    table.hourly-forecast tr:last-child td {
      border-bottom: none;
    }

    .footer {
      position:fixed;
      bottom:20px;
      width:100%;
      text-align:center;
      z-index:9;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: #000000;
      text-shadow: none;
    }

    .btn-detail {
      padding: 6px 18px;
      font-size: 16px;
      background-color: #A3BFD9;
      border: none;
      border-radius: 24px;
      color: #000000;
      cursor: pointer;
      box-shadow: none;
      transition: background-color 0.3s ease;
    }
    .btn-detail:hover {
      background-color: #89aadb;
    }

    * { box-sizing: border-box; }
  </style>
</head>
<body>
  <div class="banner" role="banner">
    <div class="left">
      <div class="brand">Weather.ru</div>
    </div>
    <div class="center">
      <div class="time" id="time">--:-- --</div>
    </div>
    <div class="right">
      <div class="cond" id="cond">-- ℃ · --</div>
    </div>
  </div>

  <main class="main">
    <div class="big-temp" id="bigTemp">-- ℃</div>
    <div class="small" id="location">Loading...</div>

    <table class="hourly-forecast" aria-label="未來24小時天氣預報" id="hourlyTable">
      <thead>
        <tr>
          <th>時間</th>
          <th>天氣</th>
          <th>溫度</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="3">載入中...</td></tr>
      </tbody>
    </table>
  </main>

  <div class="footer" id="footer">
    <button class="btn-detail" onclick="window.open('https://www.msn.com/zh-tw/weather/forecast/in-%E5%8D%97%E5%8D%80,%E8%87%BA%E4%B8%AD%E5%B8%82?loc=eyJsIjoi5Y2X5Y2AIiwiciI6IuiHuuS4reW4giIsInIyIjoi6Ie65Lit5biCIiwiYyI6IuWPsOeBoyIsImkiOiJUVyIsInQiOjEwMiwiZyI6InpoLXR3IiwieCI6IjEyMC42NjQiLCJ5IjoiMjQuMTE3MSJ9&weadegreetype=C&cvid=ee279de14a52445cdaedb12e4e9d9035&ei=9', '_blank')">查看詳細天氣</button>
    <div>資料來源：weatherapi.com</div>
  </div>

  <script>
    const API_KEY = '177eb0e0b74c4d6387812011250908';
    const CITY = 'Taichung';
    const WEATHER_REFRESH_MS = 5 * 60 * 1000;

    // 中文天氣狀態字典(補全+保底翻譯)
    const condMap = {
      "Sunny": "晴天",
      "Clear": "晴朗",
      "Partly cloudy": "多雲",
      "Cloudy": "多雲",
      "Overcast": "陰天",
      "Mist": "薄霧",
      "Patchy rain possible": "可能小雨",
      "Patchy snow possible": "可能小雪",
      "Patchy sleet possible": "可能凍雨",
      "Patchy freezing drizzle possible": "可能凍毛毛雨",
      "Thundery outbreaks possible": "可能雷陣雨",
      "Blowing snow": "飄雪",
      "Blizzard": "暴風雪",
      "Fog": "濃霧",
      "Freezing fog": "凍霧",
      "Patchy light drizzle": "局部小毛毛雨",
      "Light drizzle": "小毛毛雨",
      "Freezing drizzle": "凍毛毛雨",
      "Heavy freezing drizzle": "大量凍毛毛雨",
      "Patchy light rain": "局部小雨",
      "Light rain": "小雨",
      "Moderate rain at times": "間歇中雨",
      "Moderate rain": "中雨",
      "Heavy rain at times": "間歇大雨",
      "Heavy rain": "大雨",
      "Light freezing rain": "輕微凍雨",
      "Moderate or heavy freezing rain": "中大凍雨",
      "Light sleet": "輕微凍雪",
      "Moderate or heavy sleet": "中大凍雪",
      "Patchy light snow": "局部小雪",
      "Light snow": "小雪",
      "Patchy moderate snow": "局部中雪",
      "Moderate snow": "中雪",
      "Patchy heavy snow": "局部大雪",
      "Heavy snow": "大雪",
      "Ice pellets": "冰粒",
      "Light rain shower": "小陣雨",
      "Moderate or heavy rain shower": "中大陣雨",
      "Torrential rain shower": "暴雨",
      "Light sleet showers": "輕微凍雪陣雨",
      "Moderate or heavy sleet showers": "中大凍雪陣雨",
      "Light snow showers": "輕微雪陣雨",
      "Moderate or heavy snow showers": "中大雪陣雨",
      "Light showers of ice pellets": "輕微冰粒陣雨",
      "Moderate or heavy showers of ice pellets": "中大冰粒陣雨",
      "Patchy light rain with thunder": "局部小雷雨",
      "Moderate or heavy rain with thunder": "中大雷雨",
      "Patchy light snow with thunder": "局部小雷雪",
      "Moderate or heavy snow with thunder": "中大雷雪"
    };

    // 保底中文翻譯函數：把英文拆詞翻成中文字串（簡單處理）
    function fallbackTranslate(eng) {
      // 例如 "Light rain" => "輕微雨"
      // 簡單字典拆解
      const wordsMap = {
        "light": "輕微",
        "patchy": "局部",
        "moderate": "中度",
        "heavy": "大量",
        "showers": "陣雨",
        "rain": "雨",
        "snow": "雪",
        "sleet": "凍雨",
        "freezing": "凍",
        "thunder": "雷雨",
        "possible": "可能",
        "drizzle": "毛毛雨",
        "overcast": "陰天",
        "cloudy": "多雲",
        "clear": "晴朗",
        "sunny": "晴天",
        "fog": "霧",
        "mist": "霧",
        "blizzard": "暴風雪",
        "blowing": "吹",
        "pellets": "冰粒",
        "rainy": "雨",
        "outbreaks": "陣雨"
      };

      let result = eng.toLowerCase().split(/[\s\-]+/).map(w => wordsMap[w] || w).join("");
      // 轉首字大寫
      result = result.charAt(0).toUpperCase() + result.slice(1);
      return result;
    }

    function translateCond(eng) {
      return condMap[eng] || fallbackTranslate(eng);
    }

    function updateTime(localIso=null) {
      let d = localIso ? new Date(localIso) : new Date();
      let h = d.getHours();
      const m = d.getMinutes();
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12;
      if (h === 0) h = 12;
      const mm = m.toString().padStart(2,'0');
      document.getElementById('time').textContent = `${h}:${mm} ${ampm}`;
    }

    function formatHourlyRow(hourData) {
      const dt = new Date(hourData.time);
      const month = dt.getMonth() + 1;
      const date = dt.getDate();
      const hh = dt.getHours().toString().padStart(2, '0');
      const mm = dt.getMinutes().toString().padStart(2, '0');
      const timeStr = `${month}/${date} ${hh}:${mm}`;

      const condEng = hourData.condition.text;
      const condZh = translateCond(condEng);
      const temp = Math.round(hourData.temp_c);

      return `<tr><td>${timeStr}</td><td>${condZh}</td><td>${temp}°C</td></tr>`;
    }

    async function fetchWeather() {
      try {
        const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${encodeURIComponent(CITY)}&days=2&aqi=no&alerts=no`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('取得天氣失敗');
        const data = await res.json();

        const temp = Math.round(data.current.temp_c);
        const condEng = data.current.condition.text;
        const condZh = translateCond(condEng);
        const loc = data.location.name + (data.location.region ? ', ' + data.location.region : '') + ' · ' + data.location.country;

        document.getElementById('cond').textContent = `${temp} ℃ · ${condZh}`;
        document.getElementById('bigTemp').textContent = `${temp} ℃`;
        document.getElementById('location').textContent = loc;

        if (data.location && data.location.localtime) {
          const lt = data.location.localtime.replace(' ', 'T');
          updateTime(lt);
        } else {
          updateTime();
        }

        let hourlyData = [];
        if (data.forecast && data.forecast.forecastday && data.forecast.forecastday.length > 0) {
          const todayHours = data.forecast.forecastday[0].hour;
          const tomorrowHours = data.forecast.forecastday[1]?.hour || [];
          hourlyData = todayHours.concat(tomorrowHours);
        }

        const nowTime = new Date(data.location.localtime.replace(' ', 'T')).getTime();
        const next24Hours = hourlyData.filter(h => new Date(h.time).getTime() >= nowTime).slice(0,24);

        if (next24Hours.length === 0) {
          document.querySelector('#hourlyTable tbody').innerHTML = `<tr><td colspan="3">無未來24小時資料</td></tr>`;
        } else {
          document.querySelector('#hourlyTable tbody').innerHTML = next24Hours.map(formatHourlyRow).join('');
        }
      } catch (err) {
        console.error(err);
        document.getElementById('cond').textContent = '-- ℃ · 無資料';
        document.getElementById('bigTemp').textContent = '-- ℃';
        document.getElementById('location').textContent = '無法
